<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.8 (457454)"/><meta name="author" content="mcivor88@me.com"/><meta name="created" content="2018-08-15 22:32:19 +0000"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2018-08-31 13:51:58 +0000"/><title>Canape - 10.10.10.70</title></head><body><div>Usual approach, start off with nmap scan for services and using the vulners script to grab any obvious CVE’s:</div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2019.46.36.png" height="1040" width="1876"/><br/></div><div>Apache HTTP Server running on port 80 with multiple vulnerabilities listed, looking at the highest rated:</div><ul><li><div>CVE-2017-3176</div></li><li><div>CVE-2017-7679 </div></li><li><div>CVE-2017-7668</div></li><li><div>CVE-2017-3169</div></li></ul><div>All of these present no real attack vectors, they are all service crashes of file overruns.</div><div><br/></div><div>Poking around the web server shows a disabled endpoint “/check” which is a POST only endpoint but we have no indication of the required params:</div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2019.59.37.png" height="286" width="1110"/><br/></div><div><br/></div><div><br/></div><div>Since we have a web server we can try running Nikto against it and see what turns up. Lots of results but we we start looking through them, there is something of substance that stands out:</div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2019.50.26.png" height="1108" width="2440"/><br/></div><div><br/></div><div>The .git file appears to be available on the public web server, we can try accessing this:</div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2019.51.36.png" height="1108" width="1018"/><br/></div><div><br/></div><div><a href="https://blog.skullsecurity.org/2012/using-git-clone-to-get-pwn3d">https://blog.skullsecurity.org/2012/using-git-clone-to-get-pwn3d</a></div><div>Now that we know we have access to the .git repo file we can try and pull a clone of this and we should have access to lots of goodness!</div><div><br/></div><div>We can create a directory, pull a copy of the ./git file from the server and then use git reset (to HEAD) the repo to our local box:</div><ul><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">“wget --mirror --include-directories=/.git http://10.10.10.70/.git"</span></span></div></li><li><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="background-color: rgb(255, 250, 165); font-weight: bold;-evernote-highlight:true;">“git reset —hard"</span></span></div></li></ul><div><br/></div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2019.55.40.png" height="156" width="1548"/> </div><div><br/></div><div>Some interesting files in here:</div><ul><li><div>"<span style="font-weight: bold; background-color: rgb(255, 250, 165);-evernote-highlight:true;">__init__.py</span>" looks like a flask controller with our web server code!</div></li><li><div>Nothing much else interesting in dir </div></li></ul><div> </div><div>Looking through the python controller code, the code for the disabled “/check” endpoint looks fairly interesting:</div><div><br/></div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2020.00.35.png" height="510" width="848"/><br/></div><div> Looks like potentially some sort of opportunity for injection of os commands or potentially system file read!</div><div><br/></div><div>We can have a further dig around to see if there’s anything in the git logs:</div><div><img src="Canape%20-%2010.10.10.70.html.resources/Screen%20Shot%202018-08-17%20at%2020.07.44.png" height="338" width="934"/><br/></div><div>Confirmation that there is indeed a vulnerability in the /check endpoint! Also we may have a potential username /email!</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div>Pickle exploit resources:</div><div><a href="https://dan.lousqui.fr/explaining-and-exploiting-deserialization-vulnerability-with-python-en.html">https://dan.lousqui.fr/explaining-and-exploiting-deserialization-vulnerability-with-python-en.html</a></div><div><a href="https://lincolnloop.com/blog/playing-pickle-security/">https://lincolnloop.com/blog/playing-pickle-security/</a></div><div><a href="https://neolex-security.fr/writeup/blaze-ctf-2018secret-picklepwn/">https://neolex-security.fr/writeup/blaze-ctf-2018secret-picklepwn/</a></div><div><a href="https://blog.nelhage.com/2011/03/exploiting-pickle/">https://blog.nelhage.com/2011/03/exploiting-pickle/</a></div><div><a href="https://www.kevinlondon.com/2015/08/15/dangerous-python-functions-pt2.html">https://www.kevinlondon.com/2015/08/15/dangerous-python-functions-pt2.html</a></div></body></html>